{% extends 'autodeploy/base.html' %}
{% block content %}
<h1>–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</h1>
<form method="get" style="margin-bottom: 20px; display: flex; gap: 10px; align-items: flex-end;">
    <div>
        <label for="fio">–ü–æ–∏—Å–∫ –ø–æ –§–ò–û:</label>
        <input type="text" id="fio" name="fio" value="{{ fio_query }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û">
    </div>
    <div>
        <label for="group">–ì—Ä—É–ø–ø–∞:</label>
        <select id="group" name="group">
            <option value="">–í—Å–µ</option>
            {% for group in groups %}
                <option value="{{ group.id }}" {% if group_id|add:'' == group.id|stringformat:'s' %}selected{% endif %}>{{ group.name }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit">–ù–∞–π—Ç–∏</button>
</form>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ -->
<div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
    <h3 style="margin-top: 0; color: #495057;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏</h3>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <form method="post" action="{% url 'manage_all_containers' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="stop_all" 
                    style="background:#ffc107;color:#333;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;"
                    onclick="return confirm('–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã?')">
                üõë –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            </button>
        </form>
        <form method="post" action="{% url 'manage_all_containers' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="delete_all" 
                    style="background:#dc3545;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;"
                    onclick="return confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã. –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')">
                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            </button>
        </form>
        <form method="post" action="{% url 'manage_all_containers' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="start_all" 
                    style="background:#28a745;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;"
                    onclick="return confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã?')">
                ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            </button>
        </form>
        <form method="post" action="{% url 'manage_all_containers' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" name="action" value="cleanup_docker" 
                    style="background:#17a2b8;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;"
                    onclick="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker —Ä–µ—Å—É—Ä—Å—ã (–æ–±—Ä–∞–∑—ã, —Å–µ—Ç–∏, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã)?')">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å Docker
            </button>
        </form>
    </div>
    <div style="margin-top: 10px; font-size: 12px; color: #6c757d;">
        <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong> 
        –í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: {{ total_projects }}, 
        –ó–∞–ø—É—â–µ–Ω–æ: {{ running_projects }}, 
        –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: {{ stopped_projects }}, 
        –û—à–∏–±–∫–∏: {{ error_projects }}
    </div>
</div>

<table border="1" cellpadding="8" cellspacing="0" style="width:100%; border-collapse: collapse;">
    <thead>
        <tr>
            <th>–§–ò–û</th>
            <th>–ì—Ä—É–ø–ø–∞</th>
            <th>–î–∞—Ç–∞/–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏</th>
            <th>Frontend</th>
            <th>Backend</th>
            <th>–ê—Ä—Ö–∏–≤</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
        </tr>
    </thead>
    <tbody>
        {% for project in projects %}
        <tr>
            <td>{{ project.student.full_name }}</td>
            <td>{{ project.student.group.name }}</td>
            <td>{{ project.uploaded_at|date:'d.m.Y H:i' }}</td>
            <td>
                {% if project.frontend_url %}
                    <a href="{{ project.frontend_url }}" target="_blank">Frontend</a>
                {% else %}-{% endif %}
            </td>
            <td>
                {% if project.backend_url %}
                    <a href="{{ project.backend_url }}" target="_blank">Backend</a>
                {% else %}-{% endif %}
            </td>
            <td>
                {% if project.archive %}
                    <a href="{% url 'download_archive' project.id %}">–°–∫–∞—á–∞—Ç—å</a>
                {% else %}-{% endif %}
            </td>
            <td>
                {% if project.status == 'running' %}
                    <span style="background:#d4f8d4;color:#218838;padding:3px 10px;border-radius:12px;font-size:13px;">–ó–∞–ø—É—â–µ–Ω</span>
                {% elif project.status == 'stopped' %}
                    <span style="background:#ffe6cc;color:#b36b00;padding:3px 10px;border-radius:12px;font-size:13px;">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                {% elif project.status == 'error' %}
                    <span style="background:#ffd6d6;color:#b30000;padding:3px 10px;border-radius:12px;font-size:13px;">–û—à–∏–±–∫–∞</span>
                {% else %}
                    <span style="background:#e2e3e5;color:#333;padding:3px 10px;border-radius:12px;font-size:13px;">{{ project.status|default:'-' }}</span>
                {% endif %}
            </td>
            <td>
                <form method="post" action="{% url 'manage_container' project.id %}" style="display:inline;">
                    {% csrf_token %}
                    {% if project.status == 'stopped' or project.status == 'uploaded' %}
                        <button type="submit" name="action" value="start" style="background:#28a745;color:#fff;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                    {% endif %}
                    {% if project.status == 'running' %}
                        <button type="submit" name="action" value="stop" style="background:#ffc107;color:#333;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    {% endif %}
                    <button type="submit" name="action" value="delete" style="background:#dc3545;color:#fff;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="8" style="text-align:center;">–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %} 